---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const patterns = await getCollection('patterns');

// Collect unique pattern families
const families = Array.from(
  new Set(
    patterns.map((p) => p.data.patternFamily).filter((f) => typeof f === 'string' && f.length > 0)
  )
).sort();

// Count patterns per family
const familyMap = families.map((family) => {
  const items = patterns.filter((p) => p.data.patternFamily === family);
  return { family, count: items.length };
});
---

<BaseLayout title="Pattern Families · Collaborative Sparks">
  <section class="space-y-6 max-w-3xl">
    <header class="space-y-2">
      <h1 class="text-2xl font-semibold">Pattern Families</h1>
      <p class="text-sm text-sparks-ink/80">
        Families (or “neighborhoods”) gather patterns that share a thematic or functional resonance.
      </p>
    </header>

    <ul class="space-y-4">
      {
        familyMap.map(({ family, count }) => (
          <li>
            <a
              href={`/patterns/families/${family}`}
              class="block px-4 py-3 rounded-xl border border-sparks-amber/30 hover:bg-sparks-sun/20 transition"
            >
              <div class="flex items-center justify-between">
                <span class="font-medium">{family}</span>
                <span class="text-xs text-sparks-ink/60">{count} pattern(s)</span>
              </div>
            </a>
          </li>
        ))
      }
    </ul>
  </section>
</BaseLayout>

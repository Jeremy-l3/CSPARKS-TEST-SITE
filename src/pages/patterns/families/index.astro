---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const patterns = await getCollection('patterns');

// Collect unique tags across all patterns
const allTags = new Set<string>();
patterns.forEach((p) => {
  p.data.tags?.forEach((tag) => allTags.add(tag));
});

const tags = Array.from(allTags).sort();

// Count patterns per tag
const tagMap = tags.map((tag) => {
  const items = patterns.filter((p) => p.data.tags?.includes(tag));
  return { tag, count: items.length };
});
---

<BaseLayout title="Pattern Tags Â· Collaborative Sparks">
  <section class="space-y-6 max-w-3xl">
    <header class="space-y-2">
      <h1 class="text-2xl font-semibold">Pattern Tags</h1>
      <p class="text-sm text-sparks-ink/80">
        Tags group patterns that share a thematic or functional resonance. Browse by tag to discover
        related patterns.
      </p>
    </header>

    {
      tagMap.length > 0 ? (
        <ul class="space-y-4">
          {tagMap.map(({ tag, count }) => (
            <li>
              <a
                href={`/patterns/families/${encodeURIComponent(tag)}`}
                class="block px-4 py-3 rounded-xl border border-sparks-amber/30 hover:bg-sparks-sun/20 transition"
              >
                <div class="flex items-center justify-between">
                  <span class="font-medium">{tag}</span>
                  <span class="text-xs text-sparks-ink/60">{count} pattern(s)</span>
                </div>
              </a>
            </li>
          ))}
        </ul>
      ) : (
        <p class="text-sm text-sparks-ink/60">No tags found yet. Add tags to patterns to see them here.</p>
      )
    }
  </section>
</BaseLayout>

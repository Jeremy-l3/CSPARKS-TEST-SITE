---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import PatternCard from '../../../components/patterns/PatternCard.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const patterns = await getCollection('patterns');
  const families = Array.from(
    new Set(
      patterns.map((p) => p.data.patternFamily).filter((f) => typeof f === 'string' && f.length > 0)
    )
  );

  return families.map((fam) => ({
    params: { family: fam },
    props: { family: fam },
  }));
}

const { family } = Astro.props as { family: string };

const allPatterns = await getCollection('patterns');
const familyPatterns = allPatterns.filter((p) => p.data.patternFamily === family);
---

<BaseLayout title={`${family} · Pattern Family`}>
  <section class="space-y-6">
    <header class="space-y-2">
      <h1 class="text-2xl font-semibold">{family}</h1>
      {
        family === 'Sociocracy 3.0' && (
          <p class="text-sm text-sparks-ink/80">
            Sociocracy 3.0 is a rich open pattern library for collaborative governance. This section
            will eventually collect all CSparks patterns that relate to S3, including adaptations,
            refinements, and complementary practices.
          </p>
        )
      }
      {
        family === 'Teal Organizations' && (
          <p class="text-sm text-sparks-ink/80">
            Inspired by the ideas of Laloux’s “Reinventing Organizations,” these patterns capture
            themes of self-management, wholeness, and evolutionary purpose.
          </p>
        )
      }
      {
        family === 'Space Trains' && (
          <p class="text-sm text-sparks-ink/80">
            A speculative narrative framework for understanding complex coordination,
            multi-perspective emergence, and the deep architecture of collaborative systems.
          </p>
        )
      }

      <p class="text-sm text-sparks-ink/80">
        This family includes {familyPatterns.length} pattern(s).
      </p>
    </header>

    <div class="grid gap-4 md:grid-cols-3">
      {familyPatterns.map((p) => <PatternCard pattern={p} />)}
    </div>
  </section>
</BaseLayout>

---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import PatternCard from '../../../components/patterns/PatternCard.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const patterns = await getCollection('patterns');

  // Collect unique tags
  const allTags = new Set<string>();
  patterns.forEach((p) => {
    p.data.tags?.forEach((tag) => allTags.add(tag));
  });

  return Array.from(allTags).map((tag) => ({
    params: { family: tag },
    props: { tag },
  }));
}

const { tag } = Astro.props as { tag: string };

const allPatterns = await getCollection('patterns');
const taggedPatterns = allPatterns.filter((p) => p.data.tags?.includes(tag));
---

<BaseLayout title={`${tag} · Pattern Tag`}>
  <section class="space-y-6">
    <header class="space-y-2">
      <div class="flex items-center gap-2">
        <a href="/patterns/families" class="text-sm text-sparks-teal hover:underline">← All tags</a>
      </div>
      <h1 class="text-2xl font-semibold">{tag}</h1>
      <p class="text-sm text-sparks-ink/80">
        {taggedPatterns.length} pattern(s) tagged with "{tag}"
      </p>
    </header>

    {
      taggedPatterns.length > 0 ? (
        <div class="grid gap-4 md:grid-cols-3">
          {taggedPatterns.map((p) => (
            <PatternCard pattern={p} />
          ))}
        </div>
      ) : (
        <p class="text-sm text-sparks-ink/60">No patterns found with this tag.</p>
      )
    }
  </section>
</BaseLayout>
